# Начало
Как уже и было сказано MCP использует HTTP и WebSocket. HTTP для операций, WebSocket для принятия ивентов.<br>
Все запросы и ответы в MCP имеют JSON формат.<br>

MCP использует AES-256 для шифрования сообщений.<br>
Для шифрования используется кривая secp256k1 (Подробнее о шифровании [здесь](https://github.com/mooncatcp/docs/tree/main/ru/encryption)).<br>

Для авторизации:<br>
HTTP - Обычная авторизация с [токеном](#токен) в заголовке запроса. Токен можно получить по запросу на `/auth`.<br>
WebSocket - Передавать токен в параметре `token` при подключении к WebSocket серверу.<br>

# Обозначения
Хост - Физический/Виртуальный сервер, на котором находится ваш сервер MCP.<br>
Сервер/Провайдер - Место где хранятся и обрабатываются все данные MCP. Если проще - хомсервер<br>
Личные сообщения/Личка - Место где могут общаться два пользователя.<br>
Группа/Комната - Место где могут общаться больше двух пользователей. Если проще - как сервер/гильдия в Discord<br>

# Стандарты
По хорошему у вас должен быть домен, на котором будет работать два демона: HTTP и WebSocket.<br>
HTTP должен находится по ссылке `https://mcp.example.org`<br>
WebSocket должен находится по ссылке `wss://mcp.example.org`<br>
Дополнительно вы можете использовать `https://rules.example.org` для хранения общих правил вашего сервера. Должно возвращать текст<br>

# Токен
Токен - это строка, которая используется для авторизации пользователя.<br>
Он крайне похож на токен Discord.<br>
Токен имеет формат `mcp.<id_base64>.<random_base64>`<br>
`id_base64` - это [id](#id) пользователя, который был закодирован в base64.<br>
`random_base64` - случайный 12-байтный буфер использующийся для повышения безопасности, который был закодирован в base64.<br>

По итогу токен выглядит примерно так: `mcp.MTc0NDczODQ2NjE3MjU1NDg1.EAgmSyjTglNwVcrC`<br>

# ID
ID - это [Snowflake](https://en.wikipedia.org/wiki/Snowflake_ID), которое используется для идентификации пользователя.<br>
Epoch для каждого сервера свой, можете выбирать любой понравившийся вам.<br>
ID выглядит примерно так: `174473846617255485`<br>

# CDN Эндпоинты
CDN - это сервер, который хранит все файлы, которые были загружены на хост.<br>
Он должен находится на том же домене, что и HTTP сервер.<br>
(Вы можете сделать рероут всех запросов на иной хост, но важно чтобы все картинки были доступны по описанным ниже эндпоинтам)<br>

|             Тип             |            Эндпоинт             |     Типы файлов      |
|:---------------------------:|:-------------------------------:|:--------------------:|
|     Аватар Пользователя     | `/users/<id>/<avatar_hash>.png` | PNG, JPEG, WebP, GIF |
| Обычный аватар Пользователя |  `/assets/default_avatar.png`   |         PNG          |
|        Иконка Группы        |  `/group/<id>/<icon_hash>.png`  | PNG, JPEG, WebP, GIF |
|   Кастомный эмодзи Группы   |       `/emojis/<id>.png`        |       PNG, GIF       |
|   Кастомный стикер Группы   |      `/stickers/<id>.png`       |       PNG, GIF       |
|      Файл или картинка      |     `/attachment/<id>.png`      |        Любой         |

Если какого-то из файлов нет, то сервер должен возвращать `404`.<br>
`<id>` - это [id](#id) пользователя, группы, эмодзи или стикера.<br>
`<avatar_hash>` - это хэш аватарки пользователя. (Передается в объекте юзера)<br>
`<icon_hash>` - это хэш иконки группы. (Передается в объекте группы)<br>
ID файла или иконки передается в объекте сообщения.<br>
Вы можете сами указать обычную аватарку пользователя (Как это сделать - узнавайте в документации провайдера MCP).<br>

# Шифрование
Зачем? - Чтобы никто не мог прочитать сообщения, которые вы отправляете.<br>
Само шифрование использует алгоритм AES-256.<br>
Автор знает про TLS/SSL, но считает что его недостаточно. (При этом, пожалуйста используйте TLS/SSL в составе HTTPS / WSS, так как дополнительно шифруются только сообщения, а токены и пароли передаются без дополнительного шифрования)<br>
В личных чатах используется E2EE (End-to-End Encryption) с генерацией ключа по кривой secp256k1, а в группах - E2EE шифрование ключом группы, который генерируется создателем при создании.<br>
Ключи находятся локально на стороне клиента. Если ключ утерян, придется или просить любого участника группы отправить вам новое приглашение, либо просить друга в личных сообщениях передать вам ключ<br>
В личных чатах при начале общения пользователи обмениваются ключами.<br>
В группах ключ переносится в приглашении<br>
Подробнее о шифровании читайте здесь - [Тык :3](https://github.com/mooncatcp/docs/tree/main/ru/encryption)